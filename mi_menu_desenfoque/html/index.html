<!DOCTYPE html>
<html>
<head>
    <title>Menú FiveM Blur</title>
</head>
<body>
    
    <div style="position: absolute; top: 10%; left: 10%; background-color: rgba(0, 0, 0, 0.7); color: white; padding: 20px; border-radius: 8px; z-index: 10;">
        <h1>Menú Principal</h1>
        <p>El juego debe verse borroso detrás de mí.</p>
    </div>

    <script src="app.js"></script> 
</body>
</html>
<script>
    // =================================================================
    // CÓDIGO AÑADIDO: FUNCIÓN DE ARRASTRE (DRAG)
    // =================================================================
    const menu = document.querySelector('.menu-container');
    let isDragging = false;
    let offsetX, offsetY;

    if (menu) {
        menu.addEventListener('mousedown', (e) => {
            // Solo permitir arrastrar si se presiona la cabecera del menú (ej: h1)
            if (e.target.tagName === 'H1') {
                isDragging = true;
                offsetX = e.clientX - menu.getBoundingClientRect().left;
                offsetY = e.clientY - menu.getBoundingClientRect().top;
                menu.style.cursor = 'grabbing'; // Cambia cursor al arrastrar
            }
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            // Calcula la nueva posición del menú
            menu.style.left = e.clientX - offsetX + 'px';
            menu.style.top = e.clientY - offsetY + 'px';
            menu.style.transform = 'none'; // Desactiva el centrado CSS
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            if (menu) {
                menu.style.cursor = 'default';
            }
        });
    }
</script>
<script>
    // =================================================================
    // CÓDIGO ACTUALIZADO: FUNCIÓN DE ARRASTRE (DRAG) CON GUARDADO DE POSICIÓN
    // =================================================================
    const menu = document.querySelector('.menu-container');
    const STORAGE_KEY = 'menuPosition';
    let isDragging = false;
    let offsetX, offsetY;

    // --- FUNCIÓN AÑADIDA: CARGAR POSICIÓN ---
    function loadPosition() {
        const savedPos = localStorage.getItem(STORAGE_KEY);
        if (savedPos) {
            const { left, top } = JSON.parse(savedPos);
            menu.style.left = left;
            menu.style.top = top;
            menu.style.transform = 'none'; // Desactiva el centrado CSS
        }
    }

    if (menu) {
        // Cargar la posición al iniciar
        loadPosition();

        menu.addEventListener('mousedown', (e) => {
            if (e.target.tagName === 'H1') {
                isDragging = true;
                offsetX = e.clientX - menu.getBoundingClientRect().left;
                offsetY = e.clientY - menu.getBoundingClientRect().top;
                menu.style.cursor = 'grabbing';
            }
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            menu.style.left = e.clientX - offsetX + 'px';
            menu.style.top = e.clientY - offsetY + 'px';
        });

        document.addEventListener('mouseup', () => {
            if (isDragging) {
                // --- FUNCIÓN AÑADIDA: GUARDAR POSICIÓN ---
                const currentPos = {
                    left: menu.style.left,
                    top: menu.style.top
                };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(currentPos));
            }
            isDragging = false;
            if (menu) {
                menu.style.cursor = 'default';
            }
        });
    }
</script>
<style>
    /* ... (Todo tu código Glassmorphism CSS existente va aquí) ... */

    /* =================================================================
       CÓDIGO AÑADIDO: ANIMACIONES DE APERTURA/CIERRE
       ================================================================= */
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
        to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }

    @keyframes fadeOut {
        from { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        to { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
    }

    /* Clases para aplicar la animación */
    .menu-enter {
        animation: fadeIn 0.3s forwards; /* 'forwards' mantiene el estado final */
    }

    .menu-exit {
        animation: fadeOut 0.3s forwards;
    }
</style>
<script>
    // =================================================================
    // CÓDIGO AÑADIDO: GESTIÓN DE ANIMACIONES Y EVENTOS DE TECLADO
    // =================================================================
    
    // Escucha eventos de la aplicación FiveM (NUI)
    window.addEventListener('message', function(event) {
        const data = event.data;
        const menu = document.querySelector('.menu-container');

        if (data.action === 'openMenu') {
            menu.style.display = 'flex';
            // Aplicar la animación de entrada
            menu.classList.remove('menu-exit');
            menu.classList.add('menu-enter');

        } else if (data.action === 'closeMenu') {
            // Aplicar la animación de salida
            menu.classList.remove('menu-enter');
            menu.classList.add('menu-exit');

            // Esperar a que la animación termine antes de ocultar completamente
            setTimeout(() => {
                menu.style.display = 'none';
            }, 300); // 300ms debe coincidir con la duración de la animación (0.3s)
        }
    });

    // --- El código de Arrastre y Persistencia sigue aquí ---
</script>
.menu-container {
    /* ... otros estilos ... */
    display: none; /* ¡Asegúrate de que esta línea esté aquí! */
    /* ... otros estilos ... */
}
<button 
    onclick="sendActionToLua('ejecutar_accion_uno')" 
    style="background-color: #007bff; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; margin-top: 15px;">
    Hacer Algo
</button>
<script>
    // ... (El código de Arrastre/Persistencia va aquí) ...

    // =================================================================
    // CÓDIGO AÑADIDO: FUNCIÓN PARA ENVIAR DATOS A LUA
    // =================================================================
    function sendActionToLua(actionName) {
        // Usa la función fetch para enviar datos al script Lua
        fetch(`https://${GetParentResourceName()}/${actionName}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json; charset=UTF-8',
            },
            body: JSON.stringify({
                // Si necesitas enviar más datos, añádelos aquí (ej: 'valor': 50)
                message: 'El usuario hizo clic en ' + actionName
            })
        }).then(response => response.json()).then(data => {
            // Opcional: manejar la respuesta de Lua si la hay
            // console.log('Respuesta de Lua:', data);
        });

        // Opcional: Cierra el menú automáticamente después de la acción
        // window.gameViewManager.hide();
    }
</script>
<div class="menu-container" id="submenu-opciones" style="display: none;">
    <h1>Submenú: Opciones</h1>
    <p>Esta es una vista diferente de opciones. Usa el botón de atrás para regresar.</p>

    <button onclick="showMenu('main')" 
        style="background-color: #dc3545; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; margin-top: 15px;">
        ← Volver al Menú Principal
    </button>
</div>
<script>
    // ... (Tu función sendActionToLua() va aquí) ...

    // =================================================================
    // CÓDIGO AÑADIDO: FUNCIÓN DE CONTROL DE VISTAS
    // =================================================================
    const menuMain = document.querySelector('.menu-container'); // Tu menú principal
    const menuSub = document.getElementById('submenu-opciones'); // Tu submenú

    /**
     * Muestra la vista de menú especificada y oculta las otras.
     * @param {string} menuName - Nombre del menú a mostrar ('main' o 'submenu').
     */
    function showMenu(menuName) {
        menuMain.style.display = 'none';
        menuSub.style.display = 'none';

        if (menuName === 'main') {
            menuMain.style.display = 'flex';
        } else if (menuName === 'submenu') {
            menuSub.style.display = 'flex';
        }
        
        // Aseguramos que el menú se centre si estamos en el modo animado
        menuMain.style.transform = 'translate(-50%, -50%)'; 
    }
    
    // Por defecto, muestra el menú principal al iniciar (puedes cambiar esto si quieres que empiece oculto)
    // showMenu('main'); 
</script>
<div class="menu-container">
    <h1>Menú Principal</h1>
    <p>El juego debe verse borroso detrás de mí.</p>
    
    <button onclick="sendActionToLua('ejecutar_accion_uno')" 
        style="/* ... (los estilos CSS existentes) ... */">
        Hacer Algo (Ejecuta en Lua)
    </button>
    
    <button onclick="showMenu('submenu')"
        style="background-color: #17a2b8; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; margin-top: 10px;">
        Ir a Opciones
    </button>
</div>
<div class="menu-container" id="submenu-opciones" style="display: none;">
    <h1>Submenú: Opciones</h1>
    
    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
        <span>Modo Siempre Día</span>
        <button id="toggle-dia" onclick="toggleOption('siempre_dia')"
            style="background-color: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">
            OFF
        </button>
    </div>
    <p style="margin-top: 15px;">Usa el botón de atrás para regresar.</p>

    <button onclick="showMenu('main')" 
        style="background-color: #dc3545; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; margin-top: auto;">
        ← Volver al Menú Principal
    </button>
</div>
<script>
    // ... (Tu función showMenu() va aquí) ...

    // =================================================================
    // CÓDIGO AÑADIDO: LÓGICA DEL TOGGLE (ON/OFF)
    // =================================================================
    let isDiaOn = false;

    /**
     * Alterna el estado de una opción y notifica a Lua.
     * @param {string} optionName - El nombre de la opción a cambiar (ej: 'siempre_dia').
     */
    function toggleOption(optionName) {
        // Lógica específica para "Siempre Día"
        if (optionName === 'siempre_dia') {
            isDiaOn = !isDiaOn; // Cambia el estado (OFF -> ON o viceversa)
            const button = document.getElementById('toggle-dia');
            
            // 1. Actualiza el aspecto visual del botón
            button.textContent = isDiaOn ? 'ON' : 'OFF';
            button.style.backgroundColor = isDiaOn ? '#28a745' : '#dc3545'; // Verde para ON, Rojo para OFF

            // 2. Envía la acción a Lua
            sendActionToLua('toggle_' + optionName, { estado: isDiaOn });
        }
    }
</script>



